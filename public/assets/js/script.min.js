/* Author:
	@adamcbrewer
*/$(function(e){e.floor=$("#floor");e.stats=$("#stats");e.initDragging=function(){var e=this;this.people=this.floor.find(".person");this.draggable=this.people.draggable({grid:[45,45],containment:"parent",addClasses:!1,create:function(e,t){},start:function(t,n){e.people.not(this).removeClass("dragging");e.people.filter(this).addClass("dragging")},drag:function(e,t){},stop:function(t,n){e.people.removeClass("last-drag").filter(this).addClass("last-drag").removeClass("dragging");e.updatePersonData(this).updateProfile(this)}}).data("draggable")};e.updatePersonData=function(e){var t=parseInt(e.style.top,10),n=parseInt(e.style.left,10);e.setAttribute("data-posx",t);e.setAttribute("data-posy",n);return this},e.updateProfile=function(e){var t=this.socket;this.profiles.forEach(function(n){if(n.id==e.getAttribute("data-id")){var r={id:n.id,posx:e.getAttribute("data-posx"),posy:e.getAttribute("data-posy")};n.posx=r.posx;n.posy=r.posy;t.emit("position-update",r);return}})};e.placePeopleOnFloor=function(e){this.profiles=e.profiles;var t=this;this.profiles.forEach(function(e,n){t.floor.append(e.avatar)});this.initDragging()};e.moveAvatar=function(e){var t=this.people.filter('[data-id="'+e.id+'"]');t.attr({"data-posx":e.posx,"data-posy":e.posy}).css({left:e.posy+"px",top:e.posx+"px"})};e.updateStats=function(t){var n=t.results;n.connections&&e.stats.find('[data-live="connections"]').html(n.connections);n.moves&&e.stats.find('[data-live="moves"]').html(n.moves);n.people&&e.stats.find('[data-live="people"]').html(n.people)};e.socket.on("punch-in",function(t){e.placePeopleOnFloor(t)});e.socket.on("position-update",function(t){e.moveAvatar(t.profile)});e.socket.on("update-stats",e.updateStats)}(App));